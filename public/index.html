<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Billing App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav button:hover {
            background: #5a6fd8;
        }

        .nav button.active {
            background: #764ba2;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
            margin-bottom: 30px;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid transparent;
        }

        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #666;
            font-size: 0.9rem;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê Internet Billing App</h1>
            <p>Manage your internet billing system efficiently</p>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="content">
            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">Login</button>
                </form>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="appSection" class="content hidden">
            <div class="nav">
                <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
                <button class="nav-btn" onclick="showSection('customers')">Customers</button>
                <button class="nav-btn" onclick="showSection('packages')">Packages</button>
                <button class="nav-btn" onclick="showSection('bills')">Bills</button>
                <button class="nav-btn" onclick="showSection('payments')">Payments</button>
                <button class="nav-btn" onclick="showSection('users')">Users</button>
                <button class="btn btn-secondary" onclick="logout()" style="float: right;">Logout</button>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <h2>Dashboard Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalCustomers">-</h3>
                        <p>Total Customers</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalBills">-</h3>
                        <p>Total Bills</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalRevenue">-</h3>
                        <p>Total Revenue</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="pendingBills">-</h3>
                        <p>Pending Bills</p>
                    </div>
                </div>
                <div id="dashboardContent"></div>
            </div>

            <!-- Customers Section -->
            <div id="customers" class="section">
                <h2>Customers Management</h2>
                <button class="btn" onclick="showCustomerForm()">Add New Customer</button>
                <div id="customerForm" class="hidden" style="margin-top: 20px;">
                    <h3>Add New Customer</h3>
                    <form id="newCustomerForm">
                        <div class="form-group">
                            <label for="customerName">Name</label>
                            <input type="text" id="customerName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">Email</label>
                            <input type="email" id="customerEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Phone</label>
                            <input type="tel" id="customerPhone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="customerAddress">Address</label>
                            <textarea id="customerAddress" name="address" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="customerPackage">Package</label>
                            <select id="customerPackage" name="packageId" required>
                                <option value="">Select Package</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">Create Customer</button>
                        <button type="button" class="btn btn-secondary" onclick="hideCustomerForm()">Cancel</button>
                    </form>
                </div>
                <div id="customersList"></div>
            </div>

            <!-- Packages Section -->
            <div id="packages" class="section">
                <h2>Packages Management</h2>
                <button class="btn" onclick="showPackageForm()">Add New Package</button>
                <div id="packageForm" class="hidden" style="margin-top: 20px;">
                    <h3>Add New Package</h3>
                    <form id="newPackageForm">
                        <div class="form-group">
                            <label for="packageName">Name</label>
                            <input type="text" id="packageName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="packageSpeed">Speed (Mbps)</label>
                            <input type="number" id="packageSpeed" name="speed" required>
                        </div>
                        <div class="form-group">
                            <label for="packagePrice">Price</label>
                            <input type="number" id="packagePrice" name="price" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="packageDescription">Description</label>
                            <textarea id="packageDescription" name="description"></textarea>
                        </div>
                        <button type="submit" class="btn">Create Package</button>
                        <button type="button" class="btn btn-secondary" onclick="hidePackageForm()">Cancel</button>
                    </form>
                </div>
                <div id="packagesList"></div>
            </div>

            <!-- Bills Section -->
            <div id="bills" class="section">
                <h2>Bills Management</h2>
                <button class="btn" onclick="showBillForm()">Generate Bills</button>
                <div id="billForm" class="hidden" style="margin-top: 20px;">
                    <h3>Generate Monthly Bills</h3>
                    <form id="generateBillsForm">
                        <div class="form-group">
                            <label for="billMonth">Month</label>
                            <select id="billMonth" name="month" required>
                                <option value="">Select Month</option>
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="billYear">Year</label>
                            <input type="number" id="billYear" name="year" min="2020" max="2030" required>
                        </div>
                        <button type="submit" class="btn">Generate Bills</button>
                        <button type="button" class="btn btn-secondary" onclick="hideBillForm()">Cancel</button>
                    </form>
                </div>
                <div id="billsList"></div>
            </div>

            <!-- Payments Section -->
            <div id="payments" class="section">
                <h2>Payments Management</h2>
                <div id="paymentsList"></div>
            </div>

            <!-- Users Section -->
            <div id="users" class="section">
                <h2>Users Management</h2>
                <div id="usersList"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let token = localStorage.getItem('token');
        const API_BASE = 'http://localhost:5000/api';

        // Check authentication on page load
        if (token) {
            showApp();
        } else {
            showLogin();
        }

        // Authentication functions
        function showLogin() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('appSection').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('appSection').classList.remove('hidden');
            loadDashboard();
        }

        function logout() {
            localStorage.removeItem('token');
            showLogin();
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                email: formData.get('email'),
                password: formData.get('password')
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    token = result.token;
                    localStorage.setItem('token', token);
                    showApp();
                } else {
                    alert('Login failed: ' + result.error);
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        });

        // Navigation functions
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');

            // Load section data
            switch(sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'packages':
                    loadPackages();
                    break;
                case 'bills':
                    loadBills();
                    break;
                case 'payments':
                    loadPayments();
                    break;
                case 'users':
                    loadUsers();
                    break;
            }
        }

        // API helper function
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API call failed:', error);
                return { success: false, error: error.message };
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                const overview = await apiCall('/dashboard/overview');
                if (overview.success) {
                    updateDashboardStats(overview.data);
                }
            } catch (error) {
                console.error('Failed to load dashboard:', error);
            }
        }

        function updateDashboardStats(data) {
            document.getElementById('totalCustomers').textContent = data.totalCustomers || 0;
            document.getElementById('totalBills').textContent = data.totalBills || 0;
            document.getElementById('totalRevenue').textContent = `$${data.totalRevenue || 0}`;
            document.getElementById('pendingBills').textContent = data.pendingBills || 0;
        }

        // Customer functions
        async function loadCustomers() {
            try {
                const result = await apiCall('/customers');
                if (result.success) {
                    displayCustomers(result.data);
                }
            } catch (error) {
                console.error('Failed to load customers:', error);
            }
        }

        function displayCustomers(customers) {
            const container = document.getElementById('customersList');
            if (!customers || customers.length === 0) {
                container.innerHTML = '<p>No customers found.</p>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${customers.map(customer => `
                            <tr>
                                <td>${customer.name}</td>
                                <td>${customer.email}</td>
                                <td>${customer.phone}</td>
                                <td>${customer.address}</td>
                                <td>${customer.status}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editCustomer('${customer.id}')">Edit</button>
                                    <button class="btn btn-danger" onclick="deleteCustomer('${customer.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = table;
        }

        function showCustomerForm() {
            document.getElementById('customerForm').classList.remove('hidden');
        }

        function hideCustomerForm() {
            document.getElementById('customerForm').classList.add('hidden');
            document.getElementById('newCustomerForm').reset();
        }

        // Package functions
        async function loadPackages() {
            try {
                const result = await apiCall('/packages');
                if (result.success) {
                    displayPackages(result.data);
                }
            } catch (error) {
                console.error('Failed to load packages:', error);
            }
        }

        function displayPackages(packages) {
            const container = document.getElementById('packagesList');
            if (!packages || packages.length === 0) {
                container.innerHTML = '<p>No packages found.</p>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Speed</th>
                            <th>Price</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${packages.map(pkg => `
                            <tr>
                                <td>${pkg.name}</td>
                                <td>${pkg.speed} Mbps</td>
                                <td>$${pkg.price}</td>
                                <td>${pkg.description || '-'}</td>
                                <td>${pkg.isActive ? 'Active' : 'Inactive'}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editPackage('${pkg.id}')">Edit</button>
                                    <button class="btn btn-danger" onclick="deletePackage('${pkg.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = table;
        }

        function showPackageForm() {
            document.getElementById('packageForm').classList.remove('hidden');
        }

        function hidePackageForm() {
            document.getElementById('packageForm').classList.add('hidden');
            document.getElementById('newPackageForm').reset();
        }

        // Bill functions
        async function loadBills() {
            try {
                const result = await apiCall('/bills');
                if (result.success) {
                    displayBills(result.data);
                }
            } catch (error) {
                console.error('Failed to load bills:', error);
            }
        }

        function displayBills(bills) {
            const container = document.getElementById('billsList');
            if (!bills || bills.length === 0) {
                container.innerHTML = '<p>No bills found.</p>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Month/Year</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${bills.map(bill => `
                            <tr>
                                <td>${bill.customerName || 'N/A'}</td>
                                <td>${bill.month}/${bill.year}</td>
                                <td>$${bill.amount}</td>
                                <td>${new Date(bill.dueDate).toLocaleDateString()}</td>
                                <td>${bill.status}</td>
                                <td>
                                    <button class="btn btn-success" onclick="markAsPaid('${bill.id}')">Mark Paid</button>
                                    <button class="btn btn-danger" onclick="deleteBill('${bill.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = table;
        }

        function showBillForm() {
            document.getElementById('billForm').classList.remove('hidden');
        }

        function hideBillForm() {
            document.getElementById('billForm').classList.add('hidden');
            document.getElementById('generateBillsForm').reset();
        }

        // Payment functions
        async function loadPayments() {
            try {
                const result = await apiCall('/payments');
                if (result.success) {
                    displayPayments(result.data);
                }
            } catch (error) {
                console.error('Failed to load payments:', error);
            }
        }

        function displayPayments(payments) {
            const container = document.getElementById('paymentsList');
            if (!payments || payments.length === 0) {
                container.innerHTML = '<p>No payments found.</p>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Reference</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${payments.map(payment => `
                            <tr>
                                <td>${payment.customerName || 'N/A'}</td>
                                <td>$${payment.amount}</td>
                                <td>${payment.paymentMethod}</td>
                                <td>${new Date(payment.paymentDate).toLocaleDateString()}</td>
                                <td>${payment.status}</td>
                                <td>${payment.reference || '-'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = table;
        }

        // User functions
        async function loadUsers() {
            try {
                const result = await apiCall('/users');
                if (result.success) {
                    displayUsers(result.data);
                }
            } catch (error) {
                console.error('Failed to load users:', error);
            }
        }

        function displayUsers(users) {
            const container = document.getElementById('usersList');
            if (!users || users.length === 0) {
                container.innerHTML = '<p>No users found.</p>';
                return;
            }

            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.username}</td>
                                <td>${user.email}</td>
                                <td>${user.role}</td>
                                <td>${user.status}</td>
                                <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editUser('${user.id}')">Edit</button>
                                    <button class="btn btn-danger" onclick="deleteUser('${user.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.innerHTML = table;
        }

        // Form submission handlers
        document.getElementById('newCustomerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const result = await apiCall('/customers', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    alert('Customer created successfully!');
                    hideCustomerForm();
                    loadCustomers();
                } else {
                    alert('Failed to create customer: ' + result.error);
                }
            } catch (error) {
                alert('Failed to create customer: ' + error.message);
            }
        });

        document.getElementById('newPackageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const result = await apiCall('/packages', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    alert('Package created successfully!');
                    hidePackageForm();
                    loadPackages();
                } else {
                    alert('Failed to create package: ' + result.error);
                }
            } catch (error) {
                alert('Failed to create package: ' + error.message);
            }
        });

        document.getElementById('generateBillsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const result = await apiCall('/bills/generate', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    alert(`Generated ${result.data.length} bills successfully!`);
                    hideBillForm();
                    loadBills();
                } else {
                    alert('Failed to generate bills: ' + result.error);
                }
            } catch (error) {
                alert('Failed to generate bills: ' + error.message);
            }
        });

        // Initialize the app
        if (token) {
            loadDashboard();
        }
    </script>
</body>
</html> 